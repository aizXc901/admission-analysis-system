{% extends 'base.html' %}

{% block title %}Визуализация данных - Система анализа поступления{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="h2">Визуализация конкурсных списков</h1>
            <p>Просмотр и фильтрация данных абитуриентов</p>
        </div>
    </div>

    <!-- Фильтры -->
    <div class="row mt-4">
        <div class="col-md-6">
            <label for="dateFilter" class="form-label">Фильтр по дате:</label>
            <input type="date" class="form-control" id="dateFilter" value="{{ selected_date }}">
        </div>
        <div class="col-md-6">
            <label for="programFilter" class="form-label">Фильтр по программе:</label>
            <select class="form-select" id="programFilter">
                <option value="">Все программы</option>
                {% for program in programs %}
                <option value="{{ program.code }}" {% if selected_program == program.code %}selected{% endif %}>
                    {{ program.name }} ({{ program.code }})
                </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-12">
            <button class="btn btn-primary" onclick="applyFilters()">Применить фильтры</button>
            <button class="btn btn-secondary" onclick="resetFilters()">Сбросить фильтры</button>
        </div>
    </div>

    <!-- Таблица данных -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="table-responsive">
                <table class="table table-striped table-hover" id="dataTable">
                    <thead class="table-dark">
                        <tr>
                            <th>ID абитуриента</th>
                            <th>Образовательная программа</th>
                            <th>Сумма баллов</th>
                            <th>Наличие согласия</th>
                            <th>Приоритет</th>
                            <th>Дата</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in data_list %}
                        <tr>
                            <td>{{ item.id }}</td>
                            <td>{{ item.program_name }} ({{ item.program_code }})</td>
                            <td>{{ item.total_score }}</td>
                            <td>
                                {% if item.has_consent %}
                                    <span class="badge bg-success">Да</span>
                                {% else %}
                                    <span class="badge bg-danger">Нет</span>
                                {% endif %}
                            </td>
                            <td>{{ item.priority }}</td>
                            <td>{{ item.date }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
function applyFilters() {
    const date = document.getElementById('dateFilter').value;
    const program = document.getElementById('programFilter').value;

    // Перенаправляем на ту же страницу с параметрами фильтра
    let url = '/visualize-data/';
    const params = [];

    if(date) params.push(`date=${date}`);
    if(program) params.push(`program=${program}`);

    if(params.length > 0) {
        url += '?' + params.join('&');
    }

    window.location.href = url;
}

function resetFilters() {
    window.location.href = '/visualize-data/';
}
</script>
{% endblock %}
